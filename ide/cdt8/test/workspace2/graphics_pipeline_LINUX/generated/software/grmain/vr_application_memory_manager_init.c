
/**************************************************************************
 *
 * Generated by mcsg
 * Version 1.0.0
 * Build trunk
 * Thu May 29 15:34:38 PDT 2008
 * ARC International (c) 2008
 * This is a generated file. All manual edits will be lost.
 *
 **************************************************************************/


#include "vr_application_include.h"

VR_CONST unsigned int vr_n_memory_pools = 2;
void * vr_memory_pool [2] = { 0, 0 };
VR_CONST VrMetaMemoryPool * vr_meta_memory_pool [2] = { 0, 0 };


/* Auxiliary code for memory pool raster_pool_id*/
VrCircularBuffer_raster_pool vr_memory_pool_raster_pool __attribute__ ((section(".raster_pool"), aligned(4)));
char raster_pool_mempool_buffer[ 25344 * 8 ] __attribute__ ((section(".raster_pool"), aligned(4)));

/* Auxiliary code for memory pool grcmd_pool_id*/
VrQueue_VrHWMutexNW grcmd_pool_mempool_header __attribute__ ((section(".grcmd_pool"), aligned(4)));
char grcmd_pool_mempool_buffer[ 128 * 512 ] __attribute__ ((section(".grcmd_pool"), aligned(4)));
int
vr_app_memory_manager_init (void)
{
  void * mempool_impl VR_UNUSED_VARIABLE_ATTRIBUTE = 0;

  /* Initialization of meta memory pool structures */
  do
    {
      size_t max_size VR_UNUSED_VARIABLE_ATTRIBUTE = 0;

      max_size = 25344 + vr_get_malloc_byte_alignment_gap_hwarch_SoC_ssramInst_mmap_bank1_ram0(25344);
      if (vr_meta_memory_pool_init (raster_pool_id, "raster_pool_id", hwarch_SoC_ssramInst_mmap_bank1_ram0_membank_id, max_size, 8) < 0)
        {
          vr_set_errno (VR_NOT_ENOUGH_MEMORY);
          return -1;
        }

      max_size = 128 + vr_get_malloc_byte_alignment_gap_hwarch_SoC_ssramInst_mmap_bank1_ram0(128);
      if (vr_meta_memory_pool_init (grcmd_pool_id, "grcmd_pool_id", hwarch_SoC_ssramInst_mmap_bank1_ram0_membank_id, max_size, 512) < 0)
        {
          vr_set_errno (VR_NOT_ENOUGH_MEMORY);
          return -1;
        }
    }
  while (0);

  /* Memory pool initialization */

  do
    {
      int i;
      char * __vr_node;
      VrCircularBuffer_raster_pool* __vr_mempool_impl = &vr_memory_pool_raster_pool;
      do
        {
          int result;
          VrCircularBufferSync_rp_setup ((VrCircularBuffer_raster_pool *) (((char *) (__vr_mempool_impl))), VrHWMutexNW, result);
          if (result < 0)
            {
              vr_set_errno (VR_NOT_ENOUGH_MEMORY);
              return -1;
            }
        }
      while (0);
      __vr_node = &raster_pool_mempool_buffer[0];
      for (i = 0; i < 8; i++)
        {
          int bytes_written;
          VrCircularBuffer_raster_pool* cir_buf = ((VrCircularBuffer_raster_pool *) __vr_mempool_impl);
          VrCircularBufferNoSync_rp_fixed_size_write (cir_buf, 64, &__vr_node, 4, 1, 0, bytes_written, bytes_written);
          __vr_node += (25344);

        }
      mempool_impl = (void *) __vr_mempool_impl;
    }
    while (0);
  vr_memory_pool [raster_pool_id] = mempool_impl;

  {
    void *hdr = (void *) (&grcmd_pool_mempool_header);
    VrHWNode **head = (VrHWNode **) &VrQueue_get_head ((VrQueue_VrHWMutexNW *) hdr);
    VrHWMutexNW *mutex = (VrHWMutexNW *) &VrQueue_get_mutex ((VrQueue_VrHWMutexNW *) hdr);
    VrStackHWSync_setup (head, mutex);
    mempool_impl = (void *) vr_hw_memory_pool_init (grcmd_pool_id, 128, 512, hdr, (char *)&grcmd_pool_mempool_buffer, head);
    if (!mempool_impl)
      return -1;
  }
  vr_memory_pool [grcmd_pool_id] = mempool_impl;

  return 0;
}
